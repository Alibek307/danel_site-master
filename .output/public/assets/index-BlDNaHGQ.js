import{h as P,s as F,i as p,k as E,n as w,l as M,r as d,m as O,p as k,q as B,j as e,c as _,b as I,U as g,M as L,v as R,w as U,B as h,x as y,t as x}from"./main-CCPV2-vA.js";import{u as C,L as c}from"./useForm-CcPXm2vi.js";import{I as m}from"./input-z8qAEBEG.js";import{C as j,b as v,c as b,d as N,a as f}from"./card-D9YP67Ot.js";var K=class extends P{#t;#a=void 0;#e;#s;constructor(r,a){super(),this.#t=r,this.setOptions(a),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){const a=this.options;this.options=this.#t.defaultMutationOptions(r),F(this.options,a)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),a?.mutationKey&&this.options.mutationKey&&p(a.mutationKey)!==p(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(r){this.#r(),this.#n(r)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#r(),this.#n()}mutate(r,a){return this.#s=a,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(r)}#r(){const r=this.#e?.state??E();this.#a={...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset}}#n(r){w.batch(()=>{if(this.#s&&this.hasListeners()){const a=this.#a.variables,o=this.#a.context;r?.type==="success"?(this.#s.onSuccess?.(r.data,a,o),this.#s.onSettled?.(r.data,null,a,o)):r?.type==="error"&&(this.#s.onError?.(r.error,a,o),this.#s.onSettled?.(void 0,r.error,a,o))}this.listeners.forEach(a=>{a(this.#a)})})}};function S(r,a){const o=M(),[n]=d.useState(()=>new K(o,r));d.useEffect(()=>{n.setOptions(r)},[n,r]);const s=d.useSyncExternalStore(d.useCallback(l=>n.subscribe(w.batchCalls(l)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=d.useCallback((l,t)=>{n.mutate(l,t).catch(O)},[n]);if(s.error&&k(n.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:i,mutateAsync:s.mutate}}/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],V=B("lock",D);function q({className:r,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:_("placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex min-h-[80px] w-full min-w-0 rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...a})}function A(){const[r,a]=d.useState(!1),o=S({mutationFn:s=>y.changePassword(s),onSuccess:()=>{x.success("Пароль успешно изменен!"),a(!1),n.reset()},onError:s=>{x.error(s.message||"Ошибка при изменения пароля")}}),n=C({defaultValues:{old_password:"",new_password:"",new_password_confirm:""},onSubmit:async({value:s})=>{o.mutate(s)}});return r?e.jsxs("form",{onSubmit:s=>{s.preventDefault(),s.stopPropagation(),n.handleSubmit()},className:"space-y-4",children:[e.jsx(n.Field,{name:"old_password",validators:{onChange:({value:s})=>s?void 0:"Введите текущий пароль"},children:s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:s.name,children:"Текущий пароль"}),e.jsx(m,{id:s.name,name:s.name,type:"password",value:s.state.value,onBlur:s.handleBlur,onChange:i=>s.handleChange(i.target.value),placeholder:"Введите текущий пароль",disabled:o.isPending}),s.state.meta.errors&&e.jsx("p",{className:"text-sm text-destructive",children:s.state.meta.errors[0]})]})}),e.jsx(n.Field,{name:"new_password",validators:{onChange:({value:s})=>s?s.length<8?"Пароль должен содержать минимум 8 символов":void 0:"Введите новый пароль"},children:s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:s.name,children:"Новый пароль"}),e.jsx(m,{id:s.name,name:s.name,type:"password",value:s.state.value,onBlur:s.handleBlur,onChange:i=>s.handleChange(i.target.value),placeholder:"Минимум 8 символов",disabled:o.isPending}),s.state.meta.errors&&e.jsx("p",{className:"text-sm text-destructive",children:s.state.meta.errors[0]})]})}),e.jsx(n.Field,{name:"new_password_confirm",validators:{onChange:({value:s,fieldApi:i})=>{const l=i.form.getFieldValue("new_password");return s?s!==l?"Пароли не совпадают":void 0:"Подтвердите новый пароль"}},children:s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:s.name,children:"Подтвердите новый пароль"}),e.jsx(m,{id:s.name,name:s.name,type:"password",value:s.state.value,onBlur:s.handleBlur,onChange:i=>s.handleChange(i.target.value),placeholder:"Повторите новый пароль",disabled:o.isPending}),s.state.meta.errors&&e.jsx("p",{className:"text-sm text-destructive",children:s.state.meta.errors[0]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(n.Subscribe,{selector:s=>[s.canSubmit,s.isSubmitting],children:([s,i])=>e.jsx(h,{type:"submit",disabled:!s||o.isPending,className:"flex-1",children:o.isPending?"Изменение...":"Сохранить пароль"})}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>{a(!1),n.reset()},disabled:o.isPending,className:"flex-1",children:"Отмена"})]})]}):e.jsxs(h,{onClick:()=>a(!0),variant:"outline",className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Изменить пароль"]})}const G=function(){const{user:a,updateUser:o}=I(),[n,s]=d.useState(!1),i=S({mutationFn:t=>y.update(t),onSuccess:t=>{o(t),x.success("Профиль успешно обновлен!"),s(!1)},onError:t=>{x.error(t.message||"Ошибка обновления профиля")}}),l=C({defaultValues:{name:a?.name||"",address:a?.address||""},onSubmit:async({value:t})=>{i.mutate(t)}});return a?e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-8 flex items-center gap-3",children:[e.jsx(g,{className:"w-8 h-8"}),"Профиль пользователя"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"Личная информация"}),e.jsx(N,{children:"Вы можете изменить имя и адрес доставки"})]}),e.jsx(f,{className:"space-y-6",children:n?e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),l.handleSubmit()},className:"space-y-4",children:[e.jsx(l.Field,{name:"name",validators:{onChange:({value:t})=>!t||t.trim().length===0?"Имя обязательно":void 0},children:t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:t.name,children:"Имя"}),e.jsx(m,{id:t.name,name:t.name,type:"text",value:t.state.value,onBlur:t.handleBlur,onChange:u=>t.handleChange(u.target.value),placeholder:"Ваше имя",disabled:i.isPending}),t.state.meta.errors&&e.jsx("p",{className:"text-sm text-destructive",children:t.state.meta.errors[0]})]})}),e.jsx(l.Field,{name:"address",validators:{onChange:({value:t})=>!t||t.trim().length===0?"Адрес обязателен":void 0},children:t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:t.name,children:"Адрес доставки"}),e.jsx(q,{id:t.name,name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:u=>t.handleChange(u.target.value),placeholder:"Ваш адрес доставки",disabled:i.isPending,rows:3}),t.state.meta.errors&&e.jsx("p",{className:"text-sm text-destructive",children:t.state.meta.errors[0]})]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Email (не изменяется)"}),e.jsx(m,{value:a.email,disabled:!0,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Телефон (не изменяется)"}),e.jsx(m,{value:a.phone,disabled:!0,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(l.Subscribe,{selector:t=>[t.canSubmit,t.isSubmitting],children:([t,u])=>e.jsx(h,{type:"submit",disabled:!t||i.isPending,className:"flex-1",children:i.isPending?"Сохранение...":"Сохранить изменения"})}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>{s(!1),l.reset()},disabled:i.isPending,className:"flex-1",children:"Отмена"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(g,{className:"w-5 h-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Имя"}),e.jsx("p",{className:"font-medium",children:a.name})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"w-5 h-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Адрес доставки"}),e.jsx("p",{className:"font-medium",children:a.address})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:a.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Телефон"}),e.jsx("p",{className:"font-medium",children:a.phone})]})]})]}),e.jsx(h,{onClick:()=>s(!0),className:"w-full",children:"Редактировать профиль"})]})})]}),e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"Изменить пароль"}),e.jsx(N,{children:"Для безопасности используйте надежный пароль"})]}),e.jsx(f,{children:e.jsx(A,{})})]})]})]})}):null};export{G as component};
